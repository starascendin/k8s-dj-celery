alter table "auth"."users" drop column "deleted_at";

alter table "auth"."users" alter column "phone" set data type character varying(15) using "phone"::character varying(15);

alter table "auth"."users" alter column "phone_change" set data type character varying(15) using "phone_change"::character varying(15);

CREATE INDEX refresh_token_session_id ON auth.refresh_tokens USING btree (session_id);

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION auth.email()
 RETURNS text
 LANGUAGE sql
 STABLE
AS $function$
  select
  	coalesce(
		nullif(current_setting('request.jwt.claim.email', true), ''),
		(nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'email')
	)::text
$function$
;

CREATE OR REPLACE FUNCTION auth.role()
 RETURNS text
 LANGUAGE sql
 STABLE
AS $function$
  select
  	coalesce(
		nullif(current_setting('request.jwt.claim.role', true), ''),
		(nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'role')
	)::text
$function$
;

CREATE OR REPLACE FUNCTION auth.uid()
 RETURNS uuid
 LANGUAGE sql
 STABLE
AS $function$
  select
  	coalesce(
		nullif(current_setting('request.jwt.claim.sub', true), ''),
		(nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
	)::uuid
$function$
;

CREATE TRIGGER "test-trigger01" BEFORE DELETE ON auth.audit_log_entries FOR EACH STATEMENT EXECUTE FUNCTION pgsodium.key_encrypt_secret_raw_key();

CREATE TRIGGER on_sb_auth_user_created AFTER INSERT ON auth.users FOR EACH ROW EXECUTE FUNCTION handle_new_sb_user();


create extension if not exists "pg_jsonschema" with schema "extensions";


CREATE TABLE IF NOT EXISTS "public"."account_emailaddress" (
    "id" integer generated by default as identity not null,
    "email" character varying(254) not null,
    "verified" boolean not null,
    "primary" boolean not null,
    "user_id" bigint not null
);


CREATE TABLE IF NOT EXISTS "public"."account_emailconfirmation" (
    "id" integer generated by default as identity not null,
    "created" timestamp with time zone not null,
    "sent" timestamp with time zone,
    "key" character varying(64) not null,
    "email_address_id" integer not null
);


CREATE TABLE IF NOT EXISTS "public"."auth_group" (
    "id" integer generated by default as identity not null,
    "name" character varying(150) not null
);


CREATE TABLE IF NOT EXISTS "public"."auth_group_permissions" (
    "id" bigint generated by default as identity not null,
    "group_id" integer not null,
    "permission_id" integer not null
);


CREATE TABLE IF NOT EXISTS "public"."auth_permission" (
    "id" integer generated by default as identity not null,
    "name" character varying(255) not null,
    "content_type_id" integer not null,
    "codename" character varying(100) not null
);


CREATE TABLE IF NOT EXISTS "public"."contents_contentcreator" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "creator_name" character varying(255) not null,
    "creator_id" character varying(255) not null,
    "creator_url" character varying(255) not null,
    "profile_json_blob" jsonb not null,
    "source_channel" character varying(50) not null
);


CREATE TABLE IF NOT EXISTS "public"."contents_contentprocessed" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "number_of_speaker" integer not null,
    "processing_algo_type" character varying(50) not null,
    "processed_content_json_blob" jsonb not null,
    "state" character varying(255) not null,
    "state_artifact_blob" jsonb not null,
    "is_chunked" boolean not null,
    "output_artifacts_url" character varying(255) not null,
    "time_to_process" jsonb not null,
    "content_id" uuid not null
);


CREATE TABLE IF NOT EXISTS "public"."contents_contentsource" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "url" character varying(255) not null,
    "content_title" character varying(255) not null,
    "content_description" text not null,
    "content_categories" character varying(50) not null,
    "raw_content_json_blob" jsonb not null,
    "param_json_blob" jsonb not null,
    "speaker_type" character varying(50) not null,
    "number_of_speaker" integer not null,
    "speakers_blob" jsonb not null,
    "content_creator_id" uuid not null
);


CREATE TABLE IF NOT EXISTS "public"."contents_contentytchunk" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "transcript_start_time" integer not null,
    "content_chunk_title" text not null,
    "content_chunk_text" text not null,
    "content_segments_json" jsonb not null,
    "raw_data_json_blob" jsonb not null,
    "content_processed_id" uuid not null
);


CREATE TABLE IF NOT EXISTS "public"."contents_prompt" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "name" character varying(255) not null,
    "prompt" text not null,
    "categories" character varying(50) not null,
    "exec_type" character varying(50) not null,
    "sb_user_id" uuid
);


CREATE TABLE IF NOT EXISTS "public"."contents_promptcompletion" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "prompt_text" text not null,
    "prompt_hashed" character varying(255) not null,
    "completion_state" character varying(255) not null,
    "output_completion" text not null,
    "content_chunk_id" uuid,
    "content_processed_id" uuid,
    "prompt_id" uuid,
    "sb_user_id" uuid
);


CREATE TABLE IF NOT EXISTS "public"."contents_promptcompletionexecutionhistory" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "prompt_completion_id" uuid not null,
    "source_content_chunk_id" uuid,
    "source_content_processed_id" uuid,
    "user_processed_prompt_version_id" uuid
);


CREATE TABLE IF NOT EXISTS "public"."contents_userdefaultprompt" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "exec_type" character varying(50) not null,
    "prompt_id" uuid,
    "sb_user_id" uuid
);


CREATE TABLE IF NOT EXISTS "public"."contents_userpromptrunversion" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "run_type" character varying(255) not null,
    "processed_id" uuid,
    "sb_user_id" uuid
);


CREATE TABLE IF NOT EXISTS "public"."django_admin_log" (
    "id" integer generated by default as identity not null,
    "action_time" timestamp with time zone not null,
    "object_id" text,
    "object_repr" character varying(200) not null,
    "action_flag" smallint not null,
    "change_message" text not null,
    "content_type_id" integer,
    "user_id" bigint not null
);


CREATE TABLE IF NOT EXISTS "public"."django_celery_beat_clockedschedule" (
    "id" integer generated by default as identity not null,
    "clocked_time" timestamp with time zone not null
);


CREATE TABLE IF NOT EXISTS "public"."django_celery_beat_crontabschedule" (
    "id" integer generated by default as identity not null,
    "minute" character varying(240) not null,
    "hour" character varying(96) not null,
    "day_of_week" character varying(64) not null,
    "day_of_month" character varying(124) not null,
    "month_of_year" character varying(64) not null,
    "timezone" character varying(63) not null
);


CREATE TABLE IF NOT EXISTS "public"."django_celery_beat_intervalschedule" (
    "id" integer generated by default as identity not null,
    "every" integer not null,
    "period" character varying(24) not null
);


CREATE TABLE IF NOT EXISTS "public"."django_celery_beat_periodictask" (
    "id" integer generated by default as identity not null,
    "name" character varying(200) not null,
    "task" character varying(200) not null,
    "args" text not null,
    "kwargs" text not null,
    "queue" character varying(200),
    "exchange" character varying(200),
    "routing_key" character varying(200),
    "expires" timestamp with time zone,
    "enabled" boolean not null,
    "last_run_at" timestamp with time zone,
    "total_run_count" integer not null,
    "date_changed" timestamp with time zone not null,
    "description" text not null,
    "crontab_id" integer,
    "interval_id" integer,
    "solar_id" integer,
    "one_off" boolean not null,
    "start_time" timestamp with time zone,
    "priority" integer,
    "headers" text not null,
    "clocked_id" integer,
    "expire_seconds" integer
);


CREATE TABLE IF NOT EXISTS "public"."django_celery_beat_periodictasks" (
    "ident" smallint not null,
    "last_update" timestamp with time zone not null
);


CREATE TABLE IF NOT EXISTS "public"."django_celery_beat_solarschedule" (
    "id" integer generated by default as identity not null,
    "event" character varying(24) not null,
    "latitude" numeric(9,6) not null,
    "longitude" numeric(9,6) not null
);


CREATE TABLE IF NOT EXISTS "public"."django_content_type" (
    "id" integer generated by default as identity not null,
    "app_label" character varying(100) not null,
    "model" character varying(100) not null
);


CREATE TABLE IF NOT EXISTS "public"."django_migrations" (
    "id" bigint generated by default as identity not null,
    "app" character varying(255) not null,
    "name" character varying(255) not null,
    "applied" timestamp with time zone not null
);


CREATE TABLE IF NOT EXISTS "public"."django_session" (
    "session_key" character varying(40) not null,
    "session_data" text not null,
    "expire_date" timestamp with time zone not null
);


CREATE TABLE IF NOT EXISTS "public"."django_site" (
    "id" integer generated by default as identity not null,
    "domain" character varying(100) not null,
    "name" character varying(50) not null
);


CREATE TABLE IF NOT EXISTS "public"."sb_users_profile" (
    "id" uuid not null,
    "first_name" text,
    "last_name" text,
    "email" character varying(255) not null,
    "openai_key" character varying(255),
    "chatgpt_plus_username" character varying(255),
    "chatgpt_plus_password" bytea,
    "avatar_pic" character varying(255),
    "username" character varying(255)
);


CREATE TABLE IF NOT EXISTS "public"."socialaccount_socialaccount" (
    "id" integer generated by default as identity not null,
    "provider" character varying(30) not null,
    "uid" character varying(191) not null,
    "last_login" timestamp with time zone not null,
    "date_joined" timestamp with time zone not null,
    "extra_data" text not null,
    "user_id" bigint not null
);


CREATE TABLE IF NOT EXISTS "public"."socialaccount_socialapp" (
    "id" integer generated by default as identity not null,
    "provider" character varying(30) not null,
    "name" character varying(40) not null,
    "client_id" character varying(191) not null,
    "secret" character varying(191) not null,
    "key" character varying(191) not null
);


CREATE TABLE IF NOT EXISTS "public"."socialaccount_socialapp_sites" (
    "id" bigint generated by default as identity not null,
    "socialapp_id" integer not null,
    "site_id" integer not null
);


CREATE TABLE IF NOT EXISTS "public"."socialaccount_socialtoken" (
    "id" integer generated by default as identity not null,
    "token" text not null,
    "token_secret" text not null,
    "expires_at" timestamp with time zone,
    "account_id" integer not null,
    "app_id" integer not null
);


CREATE TABLE IF NOT EXISTS "public"."tweetscrape_tweetdailysnap" (
    "created" timestamp with time zone not null,
    "modified" timestamp with time zone not null,
    "id" uuid not null,
    "query_params" character varying(255) not null,
    "daily_snap" text not null
);


CREATE TABLE IF NOT EXISTS "public"."users_user" (
    "id" bigint generated by default as identity not null,
    "password" character varying(128) not null,
    "last_login" timestamp with time zone,
    "is_superuser" boolean not null,
    "username" character varying(150) not null,
    "email" character varying(254) not null,
    "is_staff" boolean not null,
    "is_active" boolean not null,
    "date_joined" timestamp with time zone not null,
    "name" character varying(255) not null
);


CREATE TABLE IF NOT EXISTS "public"."users_user_groups" (
    "id" bigint generated by default as identity not null,
    "user_id" bigint not null,
    "group_id" integer not null
);


CREATE TABLE IF NOT EXISTS "public"."users_user_user_permissions" (
    "id" bigint generated by default as identity not null,
    "user_id" bigint not null,
    "permission_id" integer not null
);


CREATE INDEX account_emailaddress_email_03be32b2_like ON public.account_emailaddress USING btree (email varchar_pattern_ops);

CREATE UNIQUE INDEX account_emailaddress_email_key ON public.account_emailaddress USING btree (email);

CREATE UNIQUE INDEX account_emailaddress_pkey ON public.account_emailaddress USING btree (id);

CREATE INDEX account_emailaddress_user_id_2c513194 ON public.account_emailaddress USING btree (user_id);

CREATE INDEX account_emailconfirmation_email_address_id_5b7f8c58 ON public.account_emailconfirmation USING btree (email_address_id);

CREATE INDEX account_emailconfirmation_key_f43612bd_like ON public.account_emailconfirmation USING btree (key varchar_pattern_ops);

CREATE UNIQUE INDEX account_emailconfirmation_key_key ON public.account_emailconfirmation USING btree (key);

CREATE UNIQUE INDEX account_emailconfirmation_pkey ON public.account_emailconfirmation USING btree (id);

CREATE INDEX auth_group_name_a6ea08ec_like ON public.auth_group USING btree (name varchar_pattern_ops);

CREATE UNIQUE INDEX auth_group_name_key ON public.auth_group USING btree (name);

CREATE INDEX auth_group_permissions_group_id_b120cbf9 ON public.auth_group_permissions USING btree (group_id);

CREATE UNIQUE INDEX auth_group_permissions_group_id_permission_id_0cd325b0_uniq ON public.auth_group_permissions USING btree (group_id, permission_id);

CREATE INDEX auth_group_permissions_permission_id_84c5c92e ON public.auth_group_permissions USING btree (permission_id);

CREATE UNIQUE INDEX auth_group_permissions_pkey ON public.auth_group_permissions USING btree (id);

CREATE UNIQUE INDEX auth_group_pkey ON public.auth_group USING btree (id);

CREATE INDEX auth_permission_content_type_id_2f476e4b ON public.auth_permission USING btree (content_type_id);

CREATE UNIQUE INDEX auth_permission_content_type_id_codename_01ab375a_uniq ON public.auth_permission USING btree (content_type_id, codename);

CREATE UNIQUE INDEX auth_permission_pkey ON public.auth_permission USING btree (id);

CREATE INDEX contents_co_content_7a16e1_idx ON public.contents_contentytchunk USING btree (content_processed_id, transcript_start_time);

CREATE INDEX contents_co_url_1a7cb4_idx ON public.contents_contentsource USING btree (url);

CREATE INDEX contents_contentcreator_creator_id_2db01cf4_like ON public.contents_contentcreator USING btree (creator_id varchar_pattern_ops);

CREATE UNIQUE INDEX contents_contentcreator_creator_id_key ON public.contents_contentcreator USING btree (creator_id);

CREATE UNIQUE INDEX contents_contentcreator_pkey ON public.contents_contentcreator USING btree (id);

CREATE INDEX contents_contentprocessed_content_id_6d86ca56 ON public.contents_contentprocessed USING btree (content_id);

CREATE UNIQUE INDEX contents_contentprocessed_pkey ON public.contents_contentprocessed USING btree (id);

CREATE INDEX contents_contentsource_content_creator_id_02975f8f ON public.contents_contentsource USING btree (content_creator_id);

CREATE UNIQUE INDEX contents_contentsource_pkey ON public.contents_contentsource USING btree (id);

CREATE INDEX contents_contentsource_url_3022c682_like ON public.contents_contentsource USING btree (url varchar_pattern_ops);

CREATE UNIQUE INDEX contents_contentsource_url_key ON public.contents_contentsource USING btree (url);

CREATE INDEX contents_contentytchunk_content_processed_id_67cb6359 ON public.contents_contentytchunk USING btree (content_processed_id);

CREATE UNIQUE INDEX contents_contentytchunk_content_processed_id_tra_4f6c5680_uniq ON public.contents_contentytchunk USING btree (content_processed_id, transcript_start_time);

CREATE UNIQUE INDEX contents_contentytchunk_pkey ON public.contents_contentytchunk USING btree (id);

CREATE UNIQUE INDEX contents_prompt_pkey ON public.contents_prompt USING btree (id);

CREATE INDEX contents_prompt_sb_user_id_89852dfc ON public.contents_prompt USING btree (sb_user_id);

CREATE INDEX contents_promptcompletion_content_chunk_id_c04c36e9 ON public.contents_promptcompletion USING btree (content_chunk_id);

CREATE INDEX contents_promptcompletion_content_processed_id_721ef8f0 ON public.contents_promptcompletion USING btree (content_processed_id);

CREATE UNIQUE INDEX contents_promptcompletion_pkey ON public.contents_promptcompletion USING btree (id);

CREATE INDEX contents_promptcompletion_prompt_id_e8703dbc ON public.contents_promptcompletion USING btree (prompt_id);

CREATE INDEX contents_promptcompletion_sb_user_id_4b1e6ad0 ON public.contents_promptcompletion USING btree (sb_user_id);

CREATE INDEX contents_promptcompletione_prompt_completion_id_a6e6c44c ON public.contents_promptcompletionexecutionhistory USING btree (prompt_completion_id);

CREATE INDEX contents_promptcompletione_source_content_chunk_id_3525846d ON public.contents_promptcompletionexecutionhistory USING btree (source_content_chunk_id);

CREATE INDEX contents_promptcompletione_source_content_processed_i_078eadb6 ON public.contents_promptcompletionexecutionhistory USING btree (source_content_processed_id);

CREATE INDEX contents_promptcompletione_user_processed_prompt_vers_acd885a4 ON public.contents_promptcompletionexecutionhistory USING btree (user_processed_prompt_version_id);

CREATE UNIQUE INDEX contents_promptcompletionexecutionhistory_pkey ON public.contents_promptcompletionexecutionhistory USING btree (id);

CREATE UNIQUE INDEX contents_userdefaultprompt_pkey ON public.contents_userdefaultprompt USING btree (id);

CREATE INDEX contents_userdefaultprompt_prompt_id_3740464a ON public.contents_userdefaultprompt USING btree (prompt_id);

CREATE INDEX contents_userdefaultprompt_sb_user_id_7c3fce21 ON public.contents_userdefaultprompt USING btree (sb_user_id);

CREATE UNIQUE INDEX contents_userdefaultprompt_sb_user_id_exec_type_9686574b_uniq ON public.contents_userdefaultprompt USING btree (sb_user_id, exec_type);

CREATE UNIQUE INDEX contents_userpromptrunversion_pkey ON public.contents_userpromptrunversion USING btree (id);

CREATE INDEX contents_userpromptrunversion_processed_id_c2615d1f ON public.contents_userpromptrunversion USING btree (processed_id);

CREATE INDEX contents_userpromptrunversion_sb_user_id_f57b46fa ON public.contents_userpromptrunversion USING btree (sb_user_id);

CREATE INDEX django_admin_log_content_type_id_c4bce8eb ON public.django_admin_log USING btree (content_type_id);

CREATE UNIQUE INDEX django_admin_log_pkey ON public.django_admin_log USING btree (id);

CREATE INDEX django_admin_log_user_id_c564eba6 ON public.django_admin_log USING btree (user_id);

CREATE UNIQUE INDEX django_celery_beat_clockedschedule_pkey ON public.django_celery_beat_clockedschedule USING btree (id);

CREATE UNIQUE INDEX django_celery_beat_crontabschedule_pkey ON public.django_celery_beat_crontabschedule USING btree (id);

CREATE UNIQUE INDEX django_celery_beat_intervalschedule_pkey ON public.django_celery_beat_intervalschedule USING btree (id);

CREATE INDEX django_celery_beat_periodictask_clocked_id_47a69f82 ON public.django_celery_beat_periodictask USING btree (clocked_id);

CREATE INDEX django_celery_beat_periodictask_crontab_id_d3cba168 ON public.django_celery_beat_periodictask USING btree (crontab_id);

CREATE INDEX django_celery_beat_periodictask_interval_id_a8ca27da ON public.django_celery_beat_periodictask USING btree (interval_id);

CREATE INDEX django_celery_beat_periodictask_name_265a36b7_like ON public.django_celery_beat_periodictask USING btree (name varchar_pattern_ops);

CREATE UNIQUE INDEX django_celery_beat_periodictask_name_key ON public.django_celery_beat_periodictask USING btree (name);

CREATE UNIQUE INDEX django_celery_beat_periodictask_pkey ON public.django_celery_beat_periodictask USING btree (id);

CREATE INDEX django_celery_beat_periodictask_solar_id_a87ce72c ON public.django_celery_beat_periodictask USING btree (solar_id);

CREATE UNIQUE INDEX django_celery_beat_periodictasks_pkey ON public.django_celery_beat_periodictasks USING btree (ident);

CREATE UNIQUE INDEX django_celery_beat_solar_event_latitude_longitude_ba64999a_uniq ON public.django_celery_beat_solarschedule USING btree (event, latitude, longitude);

CREATE UNIQUE INDEX django_celery_beat_solarschedule_pkey ON public.django_celery_beat_solarschedule USING btree (id);

CREATE UNIQUE INDEX django_content_type_app_label_model_76bd3d3b_uniq ON public.django_content_type USING btree (app_label, model);

CREATE UNIQUE INDEX django_content_type_pkey ON public.django_content_type USING btree (id);

CREATE UNIQUE INDEX django_migrations_pkey ON public.django_migrations USING btree (id);

CREATE INDEX django_session_expire_date_a5c62663 ON public.django_session USING btree (expire_date);

CREATE UNIQUE INDEX django_session_pkey ON public.django_session USING btree (session_key);

CREATE INDEX django_session_session_key_c0390e0f_like ON public.django_session USING btree (session_key varchar_pattern_ops);

CREATE INDEX django_site_domain_a2e37b91_like ON public.django_site USING btree (domain varchar_pattern_ops);

CREATE UNIQUE INDEX django_site_domain_a2e37b91_uniq ON public.django_site USING btree (domain);

CREATE UNIQUE INDEX django_site_pkey ON public.django_site USING btree (id);

CREATE UNIQUE INDEX sb_users_profile_pkey ON public.sb_users_profile USING btree (id);

CREATE UNIQUE INDEX socialaccount_socialaccount_pkey ON public.socialaccount_socialaccount USING btree (id);

CREATE UNIQUE INDEX socialaccount_socialaccount_provider_uid_fc810c6e_uniq ON public.socialaccount_socialaccount USING btree (provider, uid);

CREATE INDEX socialaccount_socialaccount_user_id_8146e70c ON public.socialaccount_socialaccount USING btree (user_id);

CREATE UNIQUE INDEX socialaccount_socialapp__socialapp_id_site_id_71a9a768_uniq ON public.socialaccount_socialapp_sites USING btree (socialapp_id, site_id);

CREATE UNIQUE INDEX socialaccount_socialapp_pkey ON public.socialaccount_socialapp USING btree (id);

CREATE UNIQUE INDEX socialaccount_socialapp_sites_pkey ON public.socialaccount_socialapp_sites USING btree (id);

CREATE INDEX socialaccount_socialapp_sites_site_id_2579dee5 ON public.socialaccount_socialapp_sites USING btree (site_id);

CREATE INDEX socialaccount_socialapp_sites_socialapp_id_97fb6e7d ON public.socialaccount_socialapp_sites USING btree (socialapp_id);

CREATE INDEX socialaccount_socialtoken_account_id_951f210e ON public.socialaccount_socialtoken USING btree (account_id);

CREATE INDEX socialaccount_socialtoken_app_id_636a42d7 ON public.socialaccount_socialtoken USING btree (app_id);

CREATE UNIQUE INDEX socialaccount_socialtoken_app_id_account_id_fca4e0ac_uniq ON public.socialaccount_socialtoken USING btree (app_id, account_id);

CREATE UNIQUE INDEX socialaccount_socialtoken_pkey ON public.socialaccount_socialtoken USING btree (id);

CREATE UNIQUE INDEX tweetscrape_tweetdailysnap_pkey ON public.tweetscrape_tweetdailysnap USING btree (id);

CREATE INDEX tweetscrape_tweetdailysnap_query_params_3b398fbc_like ON public.tweetscrape_tweetdailysnap USING btree (query_params varchar_pattern_ops);

CREATE UNIQUE INDEX tweetscrape_tweetdailysnap_query_params_key ON public.tweetscrape_tweetdailysnap USING btree (query_params);

CREATE INDEX users_user_groups_group_id_9afc8d0e ON public.users_user_groups USING btree (group_id);

CREATE UNIQUE INDEX users_user_groups_pkey ON public.users_user_groups USING btree (id);

CREATE INDEX users_user_groups_user_id_5f6f5a90 ON public.users_user_groups USING btree (user_id);

CREATE UNIQUE INDEX users_user_groups_user_id_group_id_b88eab82_uniq ON public.users_user_groups USING btree (user_id, group_id);

CREATE UNIQUE INDEX users_user_pkey ON public.users_user USING btree (id);

CREATE INDEX users_user_user_permissions_permission_id_0b93982e ON public.users_user_user_permissions USING btree (permission_id);

CREATE UNIQUE INDEX users_user_user_permissions_pkey ON public.users_user_user_permissions USING btree (id);

CREATE INDEX users_user_user_permissions_user_id_20aca447 ON public.users_user_user_permissions USING btree (user_id);

CREATE UNIQUE INDEX users_user_user_permissions_user_id_permission_id_43338c45_uniq ON public.users_user_user_permissions USING btree (user_id, permission_id);

CREATE INDEX users_user_username_06e46fe6_like ON public.users_user USING btree (username varchar_pattern_ops);

CREATE UNIQUE INDEX users_user_username_key ON public.users_user USING btree (username);

alter table "public"."account_emailaddress" add constraint "account_emailaddress_pkey" PRIMARY KEY using index "account_emailaddress_pkey";

alter table "public"."account_emailconfirmation" add constraint "account_emailconfirmation_pkey" PRIMARY KEY using index "account_emailconfirmation_pkey";

alter table "public"."auth_group" add constraint "auth_group_pkey" PRIMARY KEY using index "auth_group_pkey";

alter table "public"."auth_group_permissions" add constraint "auth_group_permissions_pkey" PRIMARY KEY using index "auth_group_permissions_pkey";

alter table "public"."auth_permission" add constraint "auth_permission_pkey" PRIMARY KEY using index "auth_permission_pkey";

alter table "public"."contents_contentcreator" add constraint "contents_contentcreator_pkey" PRIMARY KEY using index "contents_contentcreator_pkey";

alter table "public"."contents_contentprocessed" add constraint "contents_contentprocessed_pkey" PRIMARY KEY using index "contents_contentprocessed_pkey";

alter table "public"."contents_contentsource" add constraint "contents_contentsource_pkey" PRIMARY KEY using index "contents_contentsource_pkey";

alter table "public"."contents_contentytchunk" add constraint "contents_contentytchunk_pkey" PRIMARY KEY using index "contents_contentytchunk_pkey";

alter table "public"."contents_prompt" add constraint "contents_prompt_pkey" PRIMARY KEY using index "contents_prompt_pkey";

alter table "public"."contents_promptcompletion" add constraint "contents_promptcompletion_pkey" PRIMARY KEY using index "contents_promptcompletion_pkey";

alter table "public"."contents_promptcompletionexecutionhistory" add constraint "contents_promptcompletionexecutionhistory_pkey" PRIMARY KEY using index "contents_promptcompletionexecutionhistory_pkey";

alter table "public"."contents_userdefaultprompt" add constraint "contents_userdefaultprompt_pkey" PRIMARY KEY using index "contents_userdefaultprompt_pkey";

alter table "public"."contents_userpromptrunversion" add constraint "contents_userpromptrunversion_pkey" PRIMARY KEY using index "contents_userpromptrunversion_pkey";

alter table "public"."django_admin_log" add constraint "django_admin_log_pkey" PRIMARY KEY using index "django_admin_log_pkey";

alter table "public"."django_celery_beat_clockedschedule" add constraint "django_celery_beat_clockedschedule_pkey" PRIMARY KEY using index "django_celery_beat_clockedschedule_pkey";

alter table "public"."django_celery_beat_crontabschedule" add constraint "django_celery_beat_crontabschedule_pkey" PRIMARY KEY using index "django_celery_beat_crontabschedule_pkey";

alter table "public"."django_celery_beat_intervalschedule" add constraint "django_celery_beat_intervalschedule_pkey" PRIMARY KEY using index "django_celery_beat_intervalschedule_pkey";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_periodictask_pkey" PRIMARY KEY using index "django_celery_beat_periodictask_pkey";

alter table "public"."django_celery_beat_periodictasks" add constraint "django_celery_beat_periodictasks_pkey" PRIMARY KEY using index "django_celery_beat_periodictasks_pkey";

alter table "public"."django_celery_beat_solarschedule" add constraint "django_celery_beat_solarschedule_pkey" PRIMARY KEY using index "django_celery_beat_solarschedule_pkey";

alter table "public"."django_content_type" add constraint "django_content_type_pkey" PRIMARY KEY using index "django_content_type_pkey";

alter table "public"."django_migrations" add constraint "django_migrations_pkey" PRIMARY KEY using index "django_migrations_pkey";

alter table "public"."django_session" add constraint "django_session_pkey" PRIMARY KEY using index "django_session_pkey";

alter table "public"."django_site" add constraint "django_site_pkey" PRIMARY KEY using index "django_site_pkey";

alter table "public"."sb_users_profile" add constraint "sb_users_profile_pkey" PRIMARY KEY using index "sb_users_profile_pkey";

alter table "public"."socialaccount_socialaccount" add constraint "socialaccount_socialaccount_pkey" PRIMARY KEY using index "socialaccount_socialaccount_pkey";

alter table "public"."socialaccount_socialapp" add constraint "socialaccount_socialapp_pkey" PRIMARY KEY using index "socialaccount_socialapp_pkey";

alter table "public"."socialaccount_socialapp_sites" add constraint "socialaccount_socialapp_sites_pkey" PRIMARY KEY using index "socialaccount_socialapp_sites_pkey";

alter table "public"."socialaccount_socialtoken" add constraint "socialaccount_socialtoken_pkey" PRIMARY KEY using index "socialaccount_socialtoken_pkey";

alter table "public"."tweetscrape_tweetdailysnap" add constraint "tweetscrape_tweetdailysnap_pkey" PRIMARY KEY using index "tweetscrape_tweetdailysnap_pkey";

alter table "public"."users_user" add constraint "users_user_pkey" PRIMARY KEY using index "users_user_pkey";

alter table "public"."users_user_groups" add constraint "users_user_groups_pkey" PRIMARY KEY using index "users_user_groups_pkey";

alter table "public"."users_user_user_permissions" add constraint "users_user_user_permissions_pkey" PRIMARY KEY using index "users_user_user_permissions_pkey";

alter table "public"."account_emailaddress" add constraint "account_emailaddress_email_key" UNIQUE using index "account_emailaddress_email_key";

alter table "public"."account_emailaddress" add constraint "account_emailaddress_user_id_2c513194_fk_users_user_id" FOREIGN KEY (user_id) REFERENCES users_user(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."account_emailaddress" validate constraint "account_emailaddress_user_id_2c513194_fk_users_user_id";

alter table "public"."account_emailconfirmation" add constraint "account_emailconfirm_email_address_id_5b7f8c58_fk_account_e" FOREIGN KEY (email_address_id) REFERENCES account_emailaddress(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."account_emailconfirmation" validate constraint "account_emailconfirm_email_address_id_5b7f8c58_fk_account_e";

alter table "public"."account_emailconfirmation" add constraint "account_emailconfirmation_key_key" UNIQUE using index "account_emailconfirmation_key_key";

alter table "public"."auth_group" add constraint "auth_group_name_key" UNIQUE using index "auth_group_name_key";

alter table "public"."auth_group_permissions" add constraint "auth_group_permissio_permission_id_84c5c92e_fk_auth_perm" FOREIGN KEY (permission_id) REFERENCES auth_permission(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."auth_group_permissions" validate constraint "auth_group_permissio_permission_id_84c5c92e_fk_auth_perm";

alter table "public"."auth_group_permissions" add constraint "auth_group_permissions_group_id_b120cbf9_fk_auth_group_id" FOREIGN KEY (group_id) REFERENCES auth_group(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."auth_group_permissions" validate constraint "auth_group_permissions_group_id_b120cbf9_fk_auth_group_id";

alter table "public"."auth_group_permissions" add constraint "auth_group_permissions_group_id_permission_id_0cd325b0_uniq" UNIQUE using index "auth_group_permissions_group_id_permission_id_0cd325b0_uniq";

alter table "public"."auth_permission" add constraint "auth_permission_content_type_id_2f476e4b_fk_django_co" FOREIGN KEY (content_type_id) REFERENCES django_content_type(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."auth_permission" validate constraint "auth_permission_content_type_id_2f476e4b_fk_django_co";

alter table "public"."auth_permission" add constraint "auth_permission_content_type_id_codename_01ab375a_uniq" UNIQUE using index "auth_permission_content_type_id_codename_01ab375a_uniq";

alter table "public"."contents_contentcreator" add constraint "contents_contentcreator_creator_id_key" UNIQUE using index "contents_contentcreator_creator_id_key";

alter table "public"."contents_contentprocessed" add constraint "contents_contentproc_content_id_6d86ca56_fk_contents_" FOREIGN KEY (content_id) REFERENCES contents_contentsource(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_contentprocessed" validate constraint "contents_contentproc_content_id_6d86ca56_fk_contents_";

alter table "public"."contents_contentsource" add constraint "contents_contentsour_content_creator_id_02975f8f_fk_contents_" FOREIGN KEY (content_creator_id) REFERENCES contents_contentcreator(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_contentsource" validate constraint "contents_contentsour_content_creator_id_02975f8f_fk_contents_";

alter table "public"."contents_contentsource" add constraint "contents_contentsource_url_key" UNIQUE using index "contents_contentsource_url_key";

alter table "public"."contents_contentytchunk" add constraint "contents_contentytch_content_processed_id_67cb6359_fk_contents_" FOREIGN KEY (content_processed_id) REFERENCES contents_contentprocessed(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_contentytchunk" validate constraint "contents_contentytch_content_processed_id_67cb6359_fk_contents_";

alter table "public"."contents_contentytchunk" add constraint "contents_contentytchunk_content_processed_id_tra_4f6c5680_uniq" UNIQUE using index "contents_contentytchunk_content_processed_id_tra_4f6c5680_uniq";

alter table "public"."contents_prompt" add constraint "contents_prompt_sb_user_id_89852dfc_fk_sb_users_profile_id" FOREIGN KEY (sb_user_id) REFERENCES sb_users_profile(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_prompt" validate constraint "contents_prompt_sb_user_id_89852dfc_fk_sb_users_profile_id";

alter table "public"."contents_promptcompletion" add constraint "contents_promptcompl_content_chunk_id_c04c36e9_fk_contents_" FOREIGN KEY (content_chunk_id) REFERENCES contents_contentytchunk(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletion" validate constraint "contents_promptcompl_content_chunk_id_c04c36e9_fk_contents_";

alter table "public"."contents_promptcompletion" add constraint "contents_promptcompl_content_processed_id_721ef8f0_fk_contents_" FOREIGN KEY (content_processed_id) REFERENCES contents_contentprocessed(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletion" validate constraint "contents_promptcompl_content_processed_id_721ef8f0_fk_contents_";

alter table "public"."contents_promptcompletion" add constraint "contents_promptcompl_prompt_id_e8703dbc_fk_contents_" FOREIGN KEY (prompt_id) REFERENCES contents_prompt(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletion" validate constraint "contents_promptcompl_prompt_id_e8703dbc_fk_contents_";

alter table "public"."contents_promptcompletion" add constraint "contents_promptcompl_sb_user_id_4b1e6ad0_fk_sb_users_" FOREIGN KEY (sb_user_id) REFERENCES sb_users_profile(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletion" validate constraint "contents_promptcompl_sb_user_id_4b1e6ad0_fk_sb_users_";

alter table "public"."contents_promptcompletionexecutionhistory" add constraint "contents_promptcompl_prompt_completion_id_a6e6c44c_fk_contents_" FOREIGN KEY (prompt_completion_id) REFERENCES contents_promptcompletion(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletionexecutionhistory" validate constraint "contents_promptcompl_prompt_completion_id_a6e6c44c_fk_contents_";

alter table "public"."contents_promptcompletionexecutionhistory" add constraint "contents_promptcompl_source_content_chunk_3525846d_fk_contents_" FOREIGN KEY (source_content_chunk_id) REFERENCES contents_contentytchunk(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletionexecutionhistory" validate constraint "contents_promptcompl_source_content_chunk_3525846d_fk_contents_";

alter table "public"."contents_promptcompletionexecutionhistory" add constraint "contents_promptcompl_source_content_proce_078eadb6_fk_contents_" FOREIGN KEY (source_content_processed_id) REFERENCES contents_contentprocessed(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletionexecutionhistory" validate constraint "contents_promptcompl_source_content_proce_078eadb6_fk_contents_";

alter table "public"."contents_promptcompletionexecutionhistory" add constraint "contents_promptcompl_user_processed_promp_acd885a4_fk_contents_" FOREIGN KEY (user_processed_prompt_version_id) REFERENCES contents_userpromptrunversion(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_promptcompletionexecutionhistory" validate constraint "contents_promptcompl_user_processed_promp_acd885a4_fk_contents_";

alter table "public"."contents_userdefaultprompt" add constraint "contents_userdefault_prompt_id_3740464a_fk_contents_" FOREIGN KEY (prompt_id) REFERENCES contents_prompt(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_userdefaultprompt" validate constraint "contents_userdefault_prompt_id_3740464a_fk_contents_";

alter table "public"."contents_userdefaultprompt" add constraint "contents_userdefault_sb_user_id_7c3fce21_fk_sb_users_" FOREIGN KEY (sb_user_id) REFERENCES sb_users_profile(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_userdefaultprompt" validate constraint "contents_userdefault_sb_user_id_7c3fce21_fk_sb_users_";

alter table "public"."contents_userdefaultprompt" add constraint "contents_userdefaultprompt_sb_user_id_exec_type_9686574b_uniq" UNIQUE using index "contents_userdefaultprompt_sb_user_id_exec_type_9686574b_uniq";

alter table "public"."contents_userpromptrunversion" add constraint "contents_userpromptr_processed_id_c2615d1f_fk_contents_" FOREIGN KEY (processed_id) REFERENCES contents_contentprocessed(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_userpromptrunversion" validate constraint "contents_userpromptr_processed_id_c2615d1f_fk_contents_";

alter table "public"."contents_userpromptrunversion" add constraint "contents_userpromptr_sb_user_id_f57b46fa_fk_sb_users_" FOREIGN KEY (sb_user_id) REFERENCES sb_users_profile(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."contents_userpromptrunversion" validate constraint "contents_userpromptr_sb_user_id_f57b46fa_fk_sb_users_";

alter table "public"."django_admin_log" add constraint "django_admin_log_action_flag_check" CHECK ((action_flag >= 0)) not valid;

alter table "public"."django_admin_log" validate constraint "django_admin_log_action_flag_check";

alter table "public"."django_admin_log" add constraint "django_admin_log_content_type_id_c4bce8eb_fk_django_co" FOREIGN KEY (content_type_id) REFERENCES django_content_type(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."django_admin_log" validate constraint "django_admin_log_content_type_id_c4bce8eb_fk_django_co";

alter table "public"."django_admin_log" add constraint "django_admin_log_user_id_c564eba6_fk_users_user_id" FOREIGN KEY (user_id) REFERENCES users_user(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."django_admin_log" validate constraint "django_admin_log_user_id_c564eba6_fk_users_user_id";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_p_clocked_id_47a69f82_fk_django_ce" FOREIGN KEY (clocked_id) REFERENCES django_celery_beat_clockedschedule(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_p_clocked_id_47a69f82_fk_django_ce";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_p_crontab_id_d3cba168_fk_django_ce" FOREIGN KEY (crontab_id) REFERENCES django_celery_beat_crontabschedule(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_p_crontab_id_d3cba168_fk_django_ce";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_p_interval_id_a8ca27da_fk_django_ce" FOREIGN KEY (interval_id) REFERENCES django_celery_beat_intervalschedule(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_p_interval_id_a8ca27da_fk_django_ce";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_p_solar_id_a87ce72c_fk_django_ce" FOREIGN KEY (solar_id) REFERENCES django_celery_beat_solarschedule(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_p_solar_id_a87ce72c_fk_django_ce";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_periodictask_expire_seconds_check" CHECK ((expire_seconds >= 0)) not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_periodictask_expire_seconds_check";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_periodictask_name_key" UNIQUE using index "django_celery_beat_periodictask_name_key";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_periodictask_priority_check" CHECK ((priority >= 0)) not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_periodictask_priority_check";

alter table "public"."django_celery_beat_periodictask" add constraint "django_celery_beat_periodictask_total_run_count_check" CHECK ((total_run_count >= 0)) not valid;

alter table "public"."django_celery_beat_periodictask" validate constraint "django_celery_beat_periodictask_total_run_count_check";

alter table "public"."django_celery_beat_solarschedule" add constraint "django_celery_beat_solar_event_latitude_longitude_ba64999a_uniq" UNIQUE using index "django_celery_beat_solar_event_latitude_longitude_ba64999a_uniq";

alter table "public"."django_content_type" add constraint "django_content_type_app_label_model_76bd3d3b_uniq" UNIQUE using index "django_content_type_app_label_model_76bd3d3b_uniq";

alter table "public"."django_site" add constraint "django_site_domain_a2e37b91_uniq" UNIQUE using index "django_site_domain_a2e37b91_uniq";

alter table "public"."socialaccount_socialaccount" add constraint "socialaccount_socialaccount_provider_uid_fc810c6e_uniq" UNIQUE using index "socialaccount_socialaccount_provider_uid_fc810c6e_uniq";

alter table "public"."socialaccount_socialaccount" add constraint "socialaccount_socialaccount_user_id_8146e70c_fk_users_user_id" FOREIGN KEY (user_id) REFERENCES users_user(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."socialaccount_socialaccount" validate constraint "socialaccount_socialaccount_user_id_8146e70c_fk_users_user_id";

alter table "public"."socialaccount_socialapp_sites" add constraint "socialaccount_social_site_id_2579dee5_fk_django_si" FOREIGN KEY (site_id) REFERENCES django_site(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."socialaccount_socialapp_sites" validate constraint "socialaccount_social_site_id_2579dee5_fk_django_si";

alter table "public"."socialaccount_socialapp_sites" add constraint "socialaccount_social_socialapp_id_97fb6e7d_fk_socialacc" FOREIGN KEY (socialapp_id) REFERENCES socialaccount_socialapp(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."socialaccount_socialapp_sites" validate constraint "socialaccount_social_socialapp_id_97fb6e7d_fk_socialacc";

alter table "public"."socialaccount_socialapp_sites" add constraint "socialaccount_socialapp__socialapp_id_site_id_71a9a768_uniq" UNIQUE using index "socialaccount_socialapp__socialapp_id_site_id_71a9a768_uniq";

alter table "public"."socialaccount_socialtoken" add constraint "socialaccount_social_account_id_951f210e_fk_socialacc" FOREIGN KEY (account_id) REFERENCES socialaccount_socialaccount(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."socialaccount_socialtoken" validate constraint "socialaccount_social_account_id_951f210e_fk_socialacc";

alter table "public"."socialaccount_socialtoken" add constraint "socialaccount_social_app_id_636a42d7_fk_socialacc" FOREIGN KEY (app_id) REFERENCES socialaccount_socialapp(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."socialaccount_socialtoken" validate constraint "socialaccount_social_app_id_636a42d7_fk_socialacc";

alter table "public"."socialaccount_socialtoken" add constraint "socialaccount_socialtoken_app_id_account_id_fca4e0ac_uniq" UNIQUE using index "socialaccount_socialtoken_app_id_account_id_fca4e0ac_uniq";

alter table "public"."tweetscrape_tweetdailysnap" add constraint "tweetscrape_tweetdailysnap_query_params_key" UNIQUE using index "tweetscrape_tweetdailysnap_query_params_key";

alter table "public"."users_user" add constraint "users_user_username_key" UNIQUE using index "users_user_username_key";

alter table "public"."users_user_groups" add constraint "users_user_groups_group_id_9afc8d0e_fk_auth_group_id" FOREIGN KEY (group_id) REFERENCES auth_group(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."users_user_groups" validate constraint "users_user_groups_group_id_9afc8d0e_fk_auth_group_id";

alter table "public"."users_user_groups" add constraint "users_user_groups_user_id_5f6f5a90_fk_users_user_id" FOREIGN KEY (user_id) REFERENCES users_user(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."users_user_groups" validate constraint "users_user_groups_user_id_5f6f5a90_fk_users_user_id";

alter table "public"."users_user_groups" add constraint "users_user_groups_user_id_group_id_b88eab82_uniq" UNIQUE using index "users_user_groups_user_id_group_id_b88eab82_uniq";

alter table "public"."users_user_user_permissions" add constraint "users_user_user_perm_permission_id_0b93982e_fk_auth_perm" FOREIGN KEY (permission_id) REFERENCES auth_permission(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."users_user_user_permissions" validate constraint "users_user_user_perm_permission_id_0b93982e_fk_auth_perm";

alter table "public"."users_user_user_permissions" add constraint "users_user_user_permissions_user_id_20aca447_fk_users_user_id" FOREIGN KEY (user_id) REFERENCES users_user(id) DEFERRABLE INITIALLY DEFERRED not valid;

alter table "public"."users_user_user_permissions" validate constraint "users_user_user_permissions_user_id_20aca447_fk_users_user_id";

alter table "public"."users_user_user_permissions" add constraint "users_user_user_permissions_user_id_permission_id_43338c45_uniq" UNIQUE using index "users_user_user_permissions_user_id_permission_id_43338c45_uniq";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.handle_new_sb_user()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
AS $function$
begin
  insert into public.sb_users_profile (id, email)
  values (new.id, new.email);
  return new;
end;
$function$
;

CREATE OR REPLACE FUNCTION public.install_available_extensions_and_test()
 RETURNS boolean
 LANGUAGE plpgsql
AS $function$
DECLARE extension_name TEXT;
allowed_extentions TEXT[] := string_to_array(current_setting('supautils.privileged_extensions'), ',');
BEGIN
  FOREACH extension_name IN ARRAY allowed_extentions
  LOOP
    SELECT trim(extension_name) INTO extension_name;
    /* skip below extensions check for now */
    CONTINUE WHEN extension_name = 'pgroonga' OR  extension_name = 'pgroonga_database' OR extension_name = 'pgsodium';
    CONTINUE WHEN extension_name = 'plpgsql' OR  extension_name = 'plpgsql_check' OR extension_name = 'pgtap';
    CONTINUE WHEN extension_name = 'supabase_vault' OR extension_name = 'wrappers';
    RAISE notice 'START TEST FOR: %', extension_name;
    EXECUTE format('DROP EXTENSION IF EXISTS %s CASCADE', quote_ident(extension_name));
    EXECUTE format('CREATE EXTENSION %s CASCADE', quote_ident(extension_name));
    RAISE notice 'END TEST FOR: %', extension_name;
  END LOOP;
    RAISE notice 'EXTENSION TESTS COMPLETED..';
    return true;
END;
$function$
;

create policy "Read only by users who created them."
on "public"."contents_prompt"
as permissive
for select
to public
using ((auth.uid() = sb_user_id));


create policy "Read only by users who created them."
on "public"."contents_userdefaultprompt"
as permissive
for select
to public
using ((auth.uid() = sb_user_id));



set check_function_bodies = off;

CREATE OR REPLACE FUNCTION storage.can_insert_object(bucketid text, name text, owner uuid, metadata jsonb)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
BEGIN
  INSERT INTO "storage"."objects" ("bucket_id", "name", "owner", "metadata") VALUES (bucketid, name, owner, metadata);
  -- hack to rollback the successful insert
  RAISE sqlstate 'PT200' using
  message = 'ROLLBACK',
  detail = 'rollback successful insert';
END
$function$
;



